"0","preprocess_neiss <- function(neiss_df, top_diags, top_parts, cols_to_use, is_new = FALSE) {"
"0","  "
"0","  return_df = NULL"
"0","  "
"0","  if(!is_new){"
"0","    cols_to_use = c(cols_to_use, ""primary_mechanism"")"
"0","  }"
"0","  "
"0","  return_df =  neiss_df |>  "
"0","    mutate( body_part = as.character(body_part)"
"0","         , diagnosis = as.character(diagnosis)"
"0","         , body_part = ifelse(body_part %in% top_parts, body_part, ""other"")"
"0","         , diagnosis = ifelse(diagnosis %in% top_diags, diagnosis, ""other"")"
"0","         , narrative = tolower(narrative)"
"0","         , sex = factor(sex)"
"0","         , body_part = factor(body_part)"
"0","         , diagnosis = factor(diagnosis)"
"0","         ) |>"
"0","    select(all_of(cols_to_use))"
"0","  "
"0","  return(return_df)"
"0","}"
"0",""
"0","get_keywords <- function(neiss_df, word_funct = str_detect ) {"
"0","  "
"0","  fall_words <- ""slip|trip|fall|dive|dove|fell|d&|foosh"""
"0","  hit_rack_words <- ""hit|paddle|racket|raquet|bat"""
"0","  hit_ball_words <- ""ball|hit with ball"""
"0","  five_words <- ""musculo|contusion|epist"""
"0","  mov_words <- ""lunge|bend|hyperex|disloc|sprain|strain|bump|tear|pop|snap|roll|cut|abrasion|sting|jam"""
"0","  heat_words <- ""heat|hot|dehydrat"""
"0","  faint_words <- ""syncope|dizz|dyspnea"" # INTERACT WITH HEAT WORDS?"
"0","  cardio_words <- ""heart|rhythm|angina|chest|chest pain|dvt|atax|weak|blood pressure|palpitat"""
"0","  hit_other <- ""fence|wall|tree|net|bench|ran into|ran"""
"0","  hit_player <- ""ran into|another|player|collieded"""
"0","  other_sport <- ""been playing|volly|baseball|basketball|soccer|football|golf|sports"""
"0",""
"0","return_df = NULL"
"0",""
"0","return_df <- neiss_df %>% "
"0","  mutate("
"0","    twist = as.integer(word_funct(narrative, ""twist"")),"
"0","    fall_words  = as.integer(word_funct(narrative, fall_words)),"
"0","    hit_rack_words = as.integer(word_funct(narrative, hit_rack_words)),"
"0","    hit_ball_words = as.integer(word_funct(narrative, hit_ball_words)),"
"0","    five_words = as.integer(word_funct(narrative, five_words)),"
"0","    mov_words = as.integer(word_funct(narrative, mov_words)),"
"0","    heat_words = as.integer(word_funct(narrative, heat_words)),"
"0","    faint_words = as.integer(word_funct(narrative, faint_words)),"
"0","    cardio_words = as.integer(word_funct(narrative, cardio_words)),"
"0","    hit_other = as.integer(word_funct(narrative, hit_other)),"
"0","    hit_player= as.integer(word_funct(narrative, hit_player)),"
"0","    other_sport = as.integer(word_funct(narrative, other_sport))"
"0","  ) |>"
"0","  select(-narrative)"
"0","  "
"0","return(return_df)"
"0","}"
